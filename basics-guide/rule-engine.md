<!-- START doctoc generated TOC please keep comment here to allow auto update -->
<!-- DON'T EDIT THIS SECTION, INSTEAD RE-RUN doctoc TO UPDATE -->
**Table of Contents**  *generated with [DocToc](https://github.com/thlorenz/doctoc)*

- [规则引擎](#%E8%A7%84%E5%88%99%E5%BC%95%E6%93%8E)
  - [规则模型](#%E8%A7%84%E5%88%99%E6%A8%A1%E5%9E%8B)
    - [节点](#%E8%8A%82%E7%82%B9)
    - [内置变量](#%E5%86%85%E7%BD%AE%E5%8F%98%E9%87%8F)
    - [连线](#%E8%BF%9E%E7%BA%BF)
    - [调试](#%E8%B0%83%E8%AF%95)
  - [规则实例](#%E8%A7%84%E5%88%99%E5%AE%9E%E4%BE%8B)
    - [启动](#%E5%90%AF%E5%8A%A8)
    - [停止](#%E5%81%9C%E6%AD%A2)
    - [执行](#%E6%89%A7%E8%A1%8C)
- [节点说明](#%E8%8A%82%E7%82%B9%E8%AF%B4%E6%98%8E)
  - [定时任务](#%E5%AE%9A%E6%97%B6%E4%BB%BB%E5%8A%A1)
      - [参数说明](#%E5%8F%82%E6%95%B0%E8%AF%B4%E6%98%8E)
      - [内置变量](#%E5%86%85%E7%BD%AE%E5%8F%98%E9%87%8F-1)
  - [通知](#%E9%80%9A%E7%9F%A5)
      - [参数说明](#%E5%8F%82%E6%95%B0%E8%AF%B4%E6%98%8E-1)
      - [内置变量](#%E5%86%85%E7%BD%AE%E5%8F%98%E9%87%8F-2)
  - [Spring Event](#spring-event)
      - [参数说明](#%E5%8F%82%E6%95%B0%E8%AF%B4%E6%98%8E-2)
      - [内置变量](#%E5%86%85%E7%BD%AE%E5%8F%98%E9%87%8F-3)
        - [推送事件](#%E6%8E%A8%E9%80%81%E4%BA%8B%E4%BB%B6)
        - [监听事件](#%E7%9B%91%E5%90%AC%E4%BA%8B%E4%BB%B6)
  - [路由](#%E8%B7%AF%E7%94%B1)
  - [接收设备消息](#%E6%8E%A5%E6%94%B6%E8%AE%BE%E5%A4%87%E6%B6%88%E6%81%AF)
      - [内置变量](#%E5%86%85%E7%BD%AE%E5%8F%98%E9%87%8F-4)
        - [设备断开连接](#%E8%AE%BE%E5%A4%87%E6%96%AD%E5%BC%80%E8%BF%9E%E6%8E%A5)
        - [设备连接](#%E8%AE%BE%E5%A4%87%E8%BF%9E%E6%8E%A5)
        - [设备事件上报](#%E8%AE%BE%E5%A4%87%E4%BA%8B%E4%BB%B6%E4%B8%8A%E6%8A%A5)
  - [操作设备](#%E6%93%8D%E4%BD%9C%E8%AE%BE%E5%A4%87)
      - [参数说明](#%E5%8F%82%E6%95%B0%E8%AF%B4%E6%98%8E-3)
      - [内置变量](#%E5%86%85%E7%BD%AE%E5%8F%98%E9%87%8F-5)
  - [Mqtt客户端](#mqtt%E5%AE%A2%E6%88%B7%E7%AB%AF)
      - [参数说明](#%E5%8F%82%E6%95%B0%E8%AF%B4%E6%98%8E-4)
      - [内置变量](#%E5%86%85%E7%BD%AE%E5%8F%98%E9%87%8F-6)
        - [接收消息](#%E6%8E%A5%E6%94%B6%E6%B6%88%E6%81%AF)
        - [推送消息](#%E6%8E%A8%E9%80%81%E6%B6%88%E6%81%AF)
  - [Tcp客户端](#tcp%E5%AE%A2%E6%88%B7%E7%AB%AF)
      - [参数说明](#%E5%8F%82%E6%95%B0%E8%AF%B4%E6%98%8E-5)
      - [内置变量](#%E5%86%85%E7%BD%AE%E5%8F%98%E9%87%8F-7)
        - [订阅消息](#%E8%AE%A2%E9%98%85%E6%B6%88%E6%81%AF)
        - [推送消息](#%E6%8E%A8%E9%80%81%E6%B6%88%E6%81%AF-1)
  - [WebSocket客户端](#websocket%E5%AE%A2%E6%88%B7%E7%AB%AF)
      - [参数说明](#%E5%8F%82%E6%95%B0%E8%AF%B4%E6%98%8E-6)
      - [内置变量](#%E5%86%85%E7%BD%AE%E5%8F%98%E9%87%8F-8)
        - [推送消息](#%E6%8E%A8%E9%80%81%E6%B6%88%E6%81%AF-2)
  - [Http客户端](#http%E5%AE%A2%E6%88%B7%E7%AB%AF)
      - [参数说明](#%E5%8F%82%E6%95%B0%E8%AF%B4%E6%98%8E-7)
      - [内置变量](#%E5%86%85%E7%BD%AE%E5%8F%98%E9%87%8F-9)
  - [CoAP客户端](#coap%E5%AE%A2%E6%88%B7%E7%AB%AF)
      - [参数说明](#%E5%8F%82%E6%95%B0%E8%AF%B4%E6%98%8E-8)
      - [内置变量](#%E5%86%85%E7%BD%AE%E5%8F%98%E9%87%8F-10)
  - [执行SQL](#%E6%89%A7%E8%A1%8Csql)
      - [参数说明](#%E5%8F%82%E6%95%B0%E8%AF%B4%E6%98%8E-9)
      - [内置变量](#%E5%86%85%E7%BD%AE%E5%8F%98%E9%87%8F-11)
  - [字段转换](#%E5%AD%97%E6%AE%B5%E8%BD%AC%E6%8D%A2)
      - [配置说明](#%E9%85%8D%E7%BD%AE%E8%AF%B4%E6%98%8E)
      - [内置变量](#%E5%86%85%E7%BD%AE%E5%8F%98%E9%87%8F-12)
  - [动态脚本](#%E5%8A%A8%E6%80%81%E8%84%9A%E6%9C%AC)
      - [参数说明](#%E5%8F%82%E6%95%B0%E8%AF%B4%E6%98%8E-10)
        - [脚本内容参数说明](#%E8%84%9A%E6%9C%AC%E5%86%85%E5%AE%B9%E5%8F%82%E6%95%B0%E8%AF%B4%E6%98%8E)
      - [内置变量](#%E5%86%85%E7%BD%AE%E5%8F%98%E9%87%8F-13)

<!-- END doctoc generated TOC please keep comment here to allow auto update -->


# 规则引擎
提供可视化,流程化的数据(逻辑)处理工具.

## 规则模型
新建规则模型

- 登录物联网管理平台。
- 选择左侧导航栏，选择规则引擎 > 规则模型。
- 在规则模型板块中，单击`新建模型`操作按钮。
- 在弹出设计器中，拖拽节点和连线生成相应规则，填写模型id和名称点击`保存`。
- 规则模型提供配置的导出、导入（支持批量导入）、复制功能

![新建规则模型](images/rule-engine/new-rule-model.gif)


### 节点
- 每一个独立的规则功能模块视为一个节点。
- 每个节点有自己对应的功能表单，用于描述节点执行功能时的所需参数。
这些参数或来自于上一节点，或直接填写，或来自于其它功能提供的选择。
- 每个节点框选中时有多个可衍生到下一节点的点，多个节点之间可通过衍生点加上`连线`组合成一个规则模型。


### 内置变量
+ 规则引擎每个节点都有一个内置的上下文，该上下文中存储着节点执行的内置变量
+ 每个节点可以获取上一节点内置变量和输出自身内置变量到下一节点
+ 上一节点输出数据的内置变量名称为 data。
    - 如上一节点输出数据为 {"username":"admin","password":"m123"}
则在下一节点可获取的内置变量为
        ```json
        {
            "data":{
                "username":"admin",
                "password":"m123"
            },
            "username":"admin",
            "password":"m123"
        }
        ```
    - 在下一节点中可以用${data.username}或者 ${username} 获取username值admin
    - ***如上一节点无数据输出，则获取上上一个节点的输出数据内置变量，以此类推直到规则开始节点***
+ 节点执行中的事件数据内置变量名称为 attr， ***节点执行错误事件会在当前节点的下个节点执行完成以前清空进而记录下一个节点的错误事件。
换言之：每个节点仅能获取自身上一个节点的错误事件数据。*** 事件类型有如下几种
    - start_with： 开始节点事件。${attr[start_with]}:获取开始节点id
    - end_with： 结束节点事件。${attr[end_with]}:获取结束节点id
    - error_type： 节点执行错误事件。${attr[error_type]}: 获取节点执行错误类型
    - error_message： 节点执行错误事件。${attr[error_message]}: 获取节点执行错误信息
    - error_stack： 节点执行错误事件。${attr[error_stack]}: 获取节点执行错误异常
    
    
### 连线
+ 多个节点之间通过`连线`连接，`连线`保证多个节点连续执行和有序执行
+ 每一个连线都可以用脚本语言（javascript）配置连接条件，如 `data.type === 1` data为节点内置变量
用于判断上一节点的执行结果是否能启动对应的下一节点执行。默认连接条件为空（连线上一节点
执行完成即执行下一节点）
+ 连线类型分为`连接`和`事件`两种<br />
    + 连接：连线的默认类型，用于连接两个节点。无节点执行状态判断<br />
    + 事件：事件类型连线可判断连线后端的节点在连线前端的节点执行之前、执行之后
或是执行失败时进行执行
+ 连线可以设置连线自身的说明、颜色。用以友好交互。

### 调试
- 单击相应的节点，在右侧节点对应的功能表单中，填写好对应的数据。
- 点击运行，填写运行时需要的执行参数。
- 点击确认。
- 在下方日志展示栏中，查看节点对应的调试日志

## 规则实例
生成规则实例
- 在规则模型列表中，选择对应的模型。
- 在对应的模型列表中，单击操作列中的发布操作，用该规则模型生成规则实例。


### 启动
选择规则引擎 > 规则实例。选择第二步发布生成的规则实例，单击操作列中启动操作
用以启动该规则。

### 停止
选择规则引擎 > 规则实例。选择已启动的规则实例，单击操作列中停止操作
用以停止该规则。

### 执行
+ 点击规则实例列表操作列中的查看详情操作
+ 在弹出的界面中点击执行按钮
+ 点击执行按钮后弹出的界面中选择开始节点、结束节点（开始、结束节点来自于规则
实例中的所有节点，且开始、结束节点可选择相同节点），填写执行参数。单击确认按钮，
在弹窗下方响应栏查看执行结果。
+ 节点执行日志：执行日志主要记录节点在执行过程中的错误信息或主动输出打印的日志信息。<br />
在第二步界面中，选择日志栏查看规则实例所有日志。
    + 选中规则实例中不同节点用以查看该节点对应的日志。
    + 选中规则实例页空白处，重新查看该规则实例所有节点日志。
+ 节点执行事件：执行事件主要记录节点执行前后节点中的数据
在第二步界面中，选择事件栏查看规则实例所有事件记录。
    + 选中规则实例中不同节点用以查看该节点对应的事件记录。
    + 选中规则实例页空白处，重新查看该规则实例所有节点事件记录。


# 节点说明

通用说明

+ 节点会在设计器中展示节点自身所需要的参数表单。
+ 每个节点通用的表单参数有 节点ID、节点类型、节点名称、节点大小、节点颜色、调度规则
    + 节点ID: 规则模型中每个节点的独立标识（自动生成不可修改）
    + 节点类型: 节点所对应的功能类型（自动生成不可修改）
    + 节点名称: 节点方块在设计器中所展示的名称
    + 节点大小: 节点方块在设计器中的尺寸大小
    + 节点颜色: 节点方块在设计器中展示的颜色
    + 调度规则: 节点在集群中的哪些主机中运行。
支持选择单个主机和选择符合规则主机配置。

## 定时任务
定时任务节点用于需要周期性执行某业务规则。如定时同步数据

#### 参数说明
| 参数        | 用途   |  是否必须  | 用例|
| --------   | :-----:  | :----:  |:----:|
| cron表达式   | 生成定时任务规则   | 是  | cron表达式([在线cron表达式](http://cron.qqe2.com/))     |
| 执行参数        |   用于定时任务执行时   |  否 |   {}   |

#### 内置变量
- 变量说明：节点执行时的当前时间戳
- 获取方式：${data}
- 变量类型：时间戳
- 例：该节点执行时间为2019-12-15 00:00:00。则该节点的内置变量如下
    ```json
    {
        "data": 1576339200000
    }
    ```
## 通知
该节点可发送邮件通知、短信通知、语音通知。

#### 参数说明
| 参数        | 用途   |  是否必须  | 用例  |
| --------   | :-----:  | :----:  | :----:  |
| 通知类型   | 设置通知类型   |   是     | 短信通知  |
| 通知器   | 设置通知类型对应的配置   |   是     | 选择通知器  |
| 通知模板   | 设置通知需要发送的内容   |   是     | 选择通知模板  |

#### 内置变量

无


## Spring Event
Spring Event 用于推送和监听spring事件。

#### 参数说明
| 参数        | 用途   |  是否必须  | 用例  |
| --------   | :-----:  | :----:  | :----:  |
| 推送事件类型   | 定义推送事件的类型   |   否     | org.jetlinks.pro.device.TestDeviceEntity |
| 监听事件类型        |   定义监听事件的类型   |  否    | org.jetlinks.pro.device.TestDeviceEntity|

#### 内置变量

##### 推送事件
- 变量说明：推送事件实体类
- 变量类型：所推送的实体类
- 获取方式：${data.field}或${field} ——field为实体类属性
- 例：推送实体类为 { "username":"admin","password":"m123"}。则该节点的内置变量如下
    ```json
    {
        "data":{
            "username":"admin",
            "password":"m123"
        },
        "username":"admin",
        "password":"m123"
    }
    ```
##### 监听事件
- 变量说明：监听事件实体类
- 变量类型：所监听的实体类
- 获取方式：${data.field}或${field} ——field为实体类属性
- 例：监听实体类为 { "username":"admin","password":"m123"}。则该节点的内置变量如下
    ```json
    {
        "data":{
            "username":"admin",
            "password":"m123"
        },
        "username":"admin",
        "password":"m123"
    }
    ```



## 路由
路由能将任意节点所产生的数据分为多份，便于特定场景下的规则处理


## 接收设备消息
该节点可以接收设备上报给平台的消息

#### 内置变量

##### 设备断开连接
- 变量说明: 设备断开连接回复的消息
- 变量类型：Map
- 获取方式：${data.field}或${field} ——field为Map key
- 内置变量如下
    ```json
    {
        "data":{
            "type":"offline",
            "deviceId":"设备Id",
            "timestamp":1576339200000,//时间戳
            "productId":"设备型号Id"
        },
        "type":"offline",
        "deviceId":"设备Id",
        "timestamp":1576339200000,//时间戳
        "productId":"设备型号Id"
    }
    ```
##### 设备连接
- 变量说明: 设备连接回复的消息
- 变量类型：Map
- 获取方式：${data.field}或${field} ——field为Map key
- 内置变量如下
    ```json
    {
        "data":{
            "type":"online",
            "deviceId":"设备Id",
            "timestamp":1576339200000,//时间戳
            "productId":"设备型号Id"
        },
        "type":"offline",
        "deviceId":"设备Id",
        "timestamp":1576339200000,//时间戳
        "productId":"设备型号Id"
    }
    ```
##### 设备事件上报
- 变量说明: 设备事件上报的消息
- 变量类型：对象
- 获取方式：${data.field}或${field} ——field为事件对象属性
- 内置变量如下
    ```json
      {
        "data": {
              "event":"事件Id",
              "code":"200",//状态码
              "messageId":"消息Id",
              "deviceId":"设备Id",
              "timestamp":1576339200000,//时间上报时时间戳,
              "success":true,  //上报结果
              "data":{
                  //...事件内容...
              }
          },
        "event":"事件Id",
        "code":"200",//状态码
        "messageId":"消息Id",
        "deviceId":"设备Id",
        "timestamp":1576339200000,//时间上报时时间戳,
        "success":true,  //上报结果
        "data":{
            //...事件内容...
        }
  }
    ```

## 操作设备
该节点可以模拟操作设备的上下线、发送消息、编码解码

#### 参数说明
| 参数        | 用途   |  是否必须  | 用例  |
| --------   | :-----:  | :----:  | :----:  |
| 操作   | 定义模拟设备操作类型   |   是     | 上线 |
| 传输协议        |   定义设备与平台的连接传输协议   |  是    | mqtt |
| 设备ID        |   定义所操作的设备ID   |  是    | deviceId |

#### 内置变量
1. 内置变量为对设备操作所发送消息 [详细](https://code.aliyun.com/jetlinks/jetlinks-pro/blob/master/docs/dev-guide/jetlinks-protocol.md)

## Mqtt客户端
该节点可以模拟Mqtt客户端消息订阅、消息推送

#### 参数说明
| 参数        | 用途   |  是否必须  | 用例  |
| --------   | :-----:  | :----:  | :----:  |
| mqtt客户端   | 设置客户端基本配置   |   是     | 弹出框中选择 |
| 操作        |   定义mqtt客户端操作类型   |  是    | 接收设备消息 |
| 消息体类型        |   定义mqtt客户端操作推送或订阅的消息类型   |  是    | JSON |
| 主题Topic        | 定义推送或订阅消息的主题   |  是    | /{productId}/{deviceId}/event/{eventId}  |
| 主题变量        | 定义推送或订阅消息的主题   |  否    | ${vars.deviceId}  |

#### 内置变量

##### 接收消息
- 变量说明: mqtt客户端接收的消息
- 变量类型：Map
- 获取方式：${data.field}或${field} ——field为Map key
- 内置变量如下
    ```json
        {
          "data": {
             "topic":"/{productId}/{deviceId}/event/{eventId}", //主题topic
             "will":false,
             "qos":0,
             "dup":false,
             "retain":false, 
             "clientId":"客户端Id", 
             "payloadType":"JSON",//接收消息类型 
             "payload": { //接收的消息
           
             }, 
             "vars":{//topic占位符变量
                 "productId":"型号Id",
                 "deviceId":"设备Id",
                 "eventId":"事件Id"
             }
          },
           "topic":"/{productId}/{deviceId}/event/{eventId}", //主题topic
           "will":false,
           "qos":0,
           "dup":false,
           "retain":false, 
           "clientId":"客户端Id", 
           "payloadType":"JSON",//接收消息类型 
           "payload": { //接收的消息
         
           }, 
           "vars":{//topic占位符变量
               "productId":"型号Id",
               "deviceId":"设备Id",
               "eventId":"事件Id"
           }   
        }
    ```

##### 推送消息
- 变量说明: 推送状态
- 变量类型：Boolean
- 获取方式：${data}
- 内置变量如下
    ```json
    {"data":true //推送成功状态}
    ```


## Tcp客户端
该节点可以模拟tcp客户端消息订阅、消息推送

#### 参数说明
| 参数        | 用途   |  是否必须  | 用例  |
| --------   | :-----:  | :----:  | :----:  |
| tcp客户端   | 设置客户端基本配置   |   是     | 弹出框中选择 |
| 操作        |   定义tcp客户端操作类型   |  是    | 订阅消息 |
| 推送消息体类型        |   定义tcp客户端推送的消息类型   |  否    | JSON |
| 订阅消息体类型        |   定义tcp客户端订阅的消息类型   |  否    | JSON |
#### 内置变量

##### 订阅消息
- 变量说明: tcp客户端接收的消息
- 变量类型：Map
- 获取方式：${data.field}或${field} ——field为Map key
- 内置变量如下
    ```json
      {
        "data":{
          "payloadType":"JSON",//接收消息类型 
          "payload": { //接收的消息
       
          }
        },
        "payloadType":"JSON",//接收消息类型 
        "payload": { //接收的消息
    
        }
      }
    ```

##### 推送消息
- 变量说明: 推送状态
- 变量类型：Boolean
- 获取方式：${data}
- 内置变量如下
    ```json
    {"data":true //推送成功状态}
    ```



## WebSocket客户端
该节点可以模拟tcp客户端消息订阅、消息推送

#### 参数说明
| 参数        | 用途   |  是否必须  | 用例  |
| --------   | :-----:  | :----:  | :----:  |
| WebSocket客户端   | 设置客户端基本配置   |   是     | 弹出框中选择 |
| 操作        |   定义WebSocket客户端操作类型   |  是    | 订阅消息 |
| 推送消息体类型        |   定义WebSocket客户端推送的消息类型   |  否    | JSON |
| 订阅消息体类型        |   定义WebSocket客户端订阅的消息类型   |  否    | JSON |

#### 内置变量
- 变量说明: WebSocket客户端接收的消息
- 变量类型：Map
- 获取方式：${data.field}或${field} ——field为Map key
- 内置变量如下
    ```json
      {
        "data":{
          "payloadType":"JSON",//接收消息类型 
          "payload": { //接收的消息
       
          }
        },
        "payloadType":"JSON",//接收消息类型 
        "payload": { //接收的消息
    
        }
      }
    ```

##### 推送消息
- 变量说明: 推送状态
- 变量类型：Boolean
- 获取方式：${data}
- 内置变量如下
    ```json
    {"data":true //推送成功状态}
    ```


## Http客户端
该节点可以模拟http客户端请求资源

#### 参数说明
| 参数        | 用途   |  是否必须  | 用例  |
| --------   | :-----:  | :----:  | :----:  |
| Http客户端   | 设置客户端基本配置   |   是     | 弹出框中选择 |
| uri        |  资源详细路径   |  是    | /demo/user/{id} |
| 请求方式        |   定义Http请求方式   |  是    | GET |
| contentType        |   定义Http contentType   |  是    | application/json |
| 请求消息体类型        |   定义Http客户端请求体的消息类型   |  是    | JSON |
| 响应消息体类型        |   定义Http服务端响应的消息类型   |  是    | JSON |

#### 内置变量
- 变量说明: http响应结果
- 变量类型：Map
- 获取方式：${data.field}或${field} ——field为Map key
- 内置变量如下
    ```json
      {
          "data":{
              "payload":{ //接收的消息
      
              },
              "payloadType":"JSON",//接收消息类型 
              "status":200,
              "headers":[
                  {
                      "name":"请求头名称",
                      "value":[
                          "请求头值1",
                          "请求头值2"
                      ]
                  }
              ],
              "contentType":"application/json"
          },
          "payload":{
      
          },
          "payloadType":"JSON",
          "status":200,
          "headers":[
              {
                  "name":"请求头名称",
                  "value":[
                      "请求头值1",
                      "请求头值2"
                  ]
              }
          ],
          "contentType":"application/json"
      }
    ```


## CoAP客户端
该节点可以模拟CoAP客户端消息订阅、消息推送

#### 参数说明
| 参数        | 用途   |  是否必须  | 用例  |
| --------   | :-----:  | :----:  | :----:  |
| CoAP客户端   | 设置客户端基本配置   |   是     | 弹出框中选择 |
| uri        |  资源详细路径   |  是    | /demo/user/{id} |
| 请求方法        |   定义CoAP请求方式   |  是    | GET |
| 消息体类型        |   定义CoAP客户端消息类型   |  是    | JSON |

#### 内置变量
- 变量说明: http响应结果
- 变量类型：Map
- 获取方式：${data.field}或${field} ——field为Map key
- 内置变量如下
    ```json
      {
          "data":{
              "payload":{ //接收的消息
      
              },
              "path":"/demo/user/{id}",//请求路径 
              "code":200, //响应状态码
              "options":{//响应集
            
              },
              "success":true //响应结果
          },
          "payload":{ //接收的消息
                
          },
          "path":"/demo/user/{id}",//请求路径 
          "code":200, //响应状态码
          "options":{//响应集
          
          },
          "success":true //响应结果
      }
    ```

## 执行SQL
该节点可以模拟数据库sql执行，支持动态选择数据源

#### 参数说明
| 参数        | 用途   |  是否必须  | 用例  |
| --------   | :-----:  | :----:  | :----:  |
| 数据源   | 设置sql执行的数据源   |   是     | 默认数据源（服务启动所连接的数据源） |
| sql        |   定义所选择数据源支持的sql语句   |  是    | select 1  |

#### 内置变量
- 变量说明: Sql执行结果
- 获取方式：如执行sql为 select 1。 则获取方式为${column}

## 字段转换
该节点可转换数据字段。如 source：a=1  target:b=1

#### 配置说明
1. 单击转换规则
2. 在弹出框中，单击添加字段
3. 输入原字段、目标字段、类型
    + 原字段：需要转换的字段
    + 目标字段：转换后生成的字段
    + 字段类型： 该字段的数据类型
4. 点击保存生成字段转换配置

      

#### 内置变量
1. 变量说明: 字段转换结果与原入参
    - 例：
    
    入参: 
    ```json
       {
        "a":1,
        "b":2
       }
    ```
    转换规则: 
    
    | 原字段    | 目标字段   |  类型  | 
    | :-----:  | :-----:  | :----: | 
    |  a  | c   |   int     |      
         
    - 内置变量为
    ```json
       {
           "data":{
               "a":1,
               "b":2,
               "c":1
           },
           "a":1,
           "b":2,
           "c":1
       }
    ```
        
2. 获取方式：${data.field}


## 动态脚本
该节点可执行脚本语言

#### 参数说明
| 参数        | 用途   |  是否必须  | 用例  |
| --------   | :-----:  | :----:  | :----:  |
| 脚本语言   | 定于将要执行的脚本语言类型   |   是     | javascript |

##### 脚本内容参数说明
1. 获取上一节点内置参数
    - 上一节点内置参数为
        ```json
           {
               "data":{
                   "a":1,
                   "b":2,
                   "c":1
               },
               "a":1,
               "b":2,
               "c":1
           }
        ```
    - 获取方式
    ```js
       var a = handler.onMessage.a; //a=1
    ```
2. 获取java类

获取方式

    ```js
       var BytesUtils = org.jetlinks.pro.network.utils.BytesUtils;
    ```
#### 内置变量

脚本执行结果