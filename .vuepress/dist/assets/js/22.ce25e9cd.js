(window.webpackJsonp=window.webpackJsonp||[]).push([[22],{333:function(e,v,i){"use strict";i.r(v);var t=i(0),_=Object(t.a)({},(function(){var e=this,v=e.$createElement,i=e._self._c||v;return i("ContentSlotsDistributor",{attrs:{"slot-key":e.$parent.slotKey}},[i("h1",{attrs:{id:"接入网关设备-并通过网关接入子设备"}},[i("a",{staticClass:"header-anchor",attrs:{href:"#接入网关设备-并通过网关接入子设备"}},[e._v("#")]),e._v(" 接入网关设备,并通过网关接入子设备")]),e._v(" "),i("p",[e._v("场景: 设备的接入是由设备侧的网关(下称父设备)代理的. 一个父设备管理着多个子设备.")]),e._v(" "),i("p",[e._v("在自定义消息协议里,将收到的"),i("code",[e._v("设备消息(ChildrenDeviceMessage)")]),e._v("转换为对应"),i("code",[e._v("子设备消息")]),e._v("即可(通过"),i("code",[e._v("DeviceMessage.deviceId")]),e._v(").")]),e._v(" "),i("p",[e._v("一个典型的流程:")]),e._v(" "),i("ol",[i("li",[e._v("自定义消息协议编解码: "),i("code",[e._v("ChildrenDeviceMessage")]),e._v("则为平台发往子设备的消息.")]),e._v(" "),i("li",[e._v("父设备通过MQTT接入平台.")]),e._v(" "),i("li",[e._v("父设备上报子设备数据,消息协议需要解码为"),i("code",[e._v("ChildDeviceMessage")]),e._v("或者"),i("code",[e._v("ChildDeviceMessageReply")]),e._v(". "),i("code",[e._v("ChildDeviceMessage.deviceId")]),e._v("为\n父设备ID,"),i("code",[e._v("ChildDeviceMessage.message.deviceId")]),e._v("为子设备ID.")]),e._v(" "),i("li",[e._v("如果平台需要发送消息到子设备,那么必须先对子设备进行上线: 消息协议解码为"),i("code",[e._v("ChildDeviceMessage.message=DeviceOnlineMessage")]),e._v(".")]),e._v(" "),i("li",[e._v("通过API直接向子设备发送消息.平台将自动根据设备关联信息转换对应的消息.")]),e._v(" "),i("li",[e._v("消息协议将收到"),i("code",[e._v("ChildDeviceMessage")]),e._v(",根据消息类型转换为对应对设备消息.")])]),e._v(" "),i("div",{staticClass:"custom-block tip"},[i("p",{staticClass:"custom-block-title"},[e._v("注意")]),e._v(" "),i("p",[e._v("在"),i("a",{attrs:{href:"https://github.com/jetlinks/jetlinks-community",target:"_blank",rel:"noopener noreferrer"}},[e._v("jetlinks-community"),i("OutboundLink")],1),e._v("\n中的模拟器内置了子设备模拟.启动模拟器时指定脚本"),i("code",[e._v("demo-children-device.js")]),e._v("即可.")])]),e._v(" "),i("p",[e._v("以"),i("a",{attrs:{href:"https://github.com/jetlinks/jetlinks-community/blob/master/simulator/scripts/demo-children-device.js",target:"_blank",rel:"noopener noreferrer"}},[e._v("demo-children-device.js"),i("OutboundLink")],1),e._v("模拟器脚本为例:")]),e._v(" "),i("ol",[i("li",[e._v("进入平台")]),e._v(" "),i("li",[e._v("使用最新的"),i("a",{attrs:{href:"https://github.com/jetlinks/jetlinks-community/blob/master/simulator/demo-protocol-1.0.jar",target:"_blank",rel:"noopener noreferrer"}},[e._v("演示协议jar包"),i("OutboundLink")],1),e._v("更新协议管理中对应的协议.")]),e._v(" "),i("li",[e._v("在设备实例中新建父设备: id为"),i("code",[e._v("gateway-1")]),e._v(".")]),e._v(" "),i("li",[e._v("在设备实例中新建子设备: id为"),i("code",[e._v("child-device-1")])]),e._v(" "),i("li",[e._v("激活设备")]),e._v(" "),i("li",[e._v("启动模拟器")]),e._v(" "),i("li",[e._v("设备状态均为在线说明成功,可以进入子设备运行状态进行相应的操作.")])])])}),[],!1,null,null,null);v.default=_.exports}}]);