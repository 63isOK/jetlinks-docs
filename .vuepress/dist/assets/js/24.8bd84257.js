(window.webpackJsonp=window.webpackJsonp||[]).push([[24],{336:function(e,v,n){"use strict";n.r(v);var _=n(0),t=Object(_.a)({},(function(){var e=this,v=e.$createElement,n=e._self._c||v;return n("ContentSlotsDistributor",{attrs:{"slot-key":e.$parent.slotKey}},[n("h1",{attrs:{id:"jetlinks-消息协议-v1-0"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#jetlinks-消息协议-v1-0"}},[e._v("#")]),e._v(" JetLinks 消息协议 v1.0")]),e._v(" "),n("ul",[n("li",[n("a",{attrs:{href:"#%E8%AE%BE%E5%A4%87%E6%A8%A1%E5%9E%8B(%E5%85%83%E6%95%B0%E6%8D%AE)%E5%AE%9A%E4%B9%89"}},[e._v("设备模型定义")]),e._v(" "),n("ul",[n("li",[n("a",{attrs:{href:"#%E5%B1%9E%E6%80%A7"}},[e._v("属性")])]),e._v(" "),n("li",[n("a",{attrs:{href:"#%E5%8A%9F%E8%83%BD"}},[e._v("功能")])]),e._v(" "),n("li",[n("a",{attrs:{href:"#%E4%BA%8B%E4%BB%B6"}},[e._v("事件")])]),e._v(" "),n("li",[n("a",{attrs:{href:"#%E6%95%B0%E6%8D%AE%E7%B1%BB%E5%9E%8B"}},[e._v("数据类型")])])])]),e._v(" "),n("li",[n("a",{attrs:{href:"#MQTT(S)%E6%8E%A5%E5%85%A5"}},[e._v("MQTT接入")]),e._v(" "),n("ul",[n("li",[n("a",{attrs:{href:"#%E8%AE%A4%E8%AF%81"}},[e._v("认证")])]),e._v(" "),n("li",[n("a",{attrs:{href:"#Topic"}},[e._v("Topic")])])])]),e._v(" "),n("li",[n("a",{attrs:{href:"#CoAP%E6%8E%A5%E5%85%A5"}},[e._v("CoAP接入")])]),e._v(" "),n("li",[n("a",{attrs:{href:"#DTLS%E6%8E%A5%E5%85%A5"}},[e._v("CoAP DTLS接入")])])]),e._v(" "),n("h2",{attrs:{id:"设备模型-元数据-定义"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#设备模型-元数据-定义"}},[e._v("#")]),e._v(" 设备模型(元数据)定义")]),e._v(" "),n("p",[e._v("设备模型分为: 属性(properties),功能(function),事件(event).")]),e._v(" "),n("p",[e._v("设备模型使用场景:")]),e._v(" "),n("ol",[n("li",[e._v("前端通过模型定义动态展示设备运行状态或者设备操作界面")]),e._v(" "),n("li",[e._v("服务端可通过统一的API获取设备模型并进行相关操作,如: 在发送设备消息时进行参数校验,\n在收到设备消息进行类型转换处理.")])]),e._v(" "),n("p",[e._v("数据结构:")]),e._v(" "),n("pre",[n("code",[e._v('{\n    "id":"设备ID",\n    "name":"设备名称",\n    "properties":[...属性],\n    "functions":[...功能],\n    "events":[...事件]\n}\n')])]),e._v(" "),n("h3",{attrs:{id:"属性"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#属性"}},[e._v("#")]),e._v(" 属性")]),e._v(" "),n("p",[e._v("用于定义设备属性,运行状态等如: 设备SN,当前CPU使用率等.\n平台可主动下发消息获取设备属性,设备也通过事件上报属性.")]),e._v(" "),n("p",[e._v("数据结构:")]),e._v(" "),n("pre",[n("code",[e._v('{\n   "id": "cpu_usage", //属性标识\n   "name": "CPU使用率",\n   "valueType": {   //值类型\n     "type": "double", //类型标识,见类型表\n     "maxValue":100,\n     "minValue":0,\n     "unit":"percent",     //单位\n     "expands":{"key1":"value1"} //其他自定义拓展定义\n   },\n   "expands":{"key1":"value1"} //其他自定义拓展定义\n }\n')])]),e._v(" "),n("h3",{attrs:{id:"功能"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#功能"}},[e._v("#")]),e._v(" 功能")]),e._v(" "),n("p",[e._v("用于定义设备功能,平台可主动调用,例如: 播放语音,开关操作等.")]),e._v(" "),n("p",[e._v("数据结构:")]),e._v(" "),n("pre",[n("code",[e._v('{\n   "id": "playVoice", //功能标识\n   "name": "播放声音", //名称\n   "inputs": [  //输入参数\n     {\n       "id": "text",\n       "name": "文字内容",\n       "valueType": { //参数类型\n         "type": "string"\n       },\n       "expands":{"key1":"value1"} //其他自定义拓展定义\n     }\n   ],\n   "output": { //输出\n     "type": "boolean" //输出类型\n   },\n   "expands":{"key1":"value1"} //其他自定义拓展定义\n }\n')])]),e._v(" "),n("h3",{attrs:{id:"事件"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#事件"}},[e._v("#")]),e._v(" 事件")]),e._v(" "),n("p",[e._v("用于定义设备事件, 如: 定时上报设备属性, 设备报警等.")]),e._v(" "),n("p",[e._v("数据结构:")]),e._v(" "),n("pre",[n("code",[e._v('{\n   "id": "fire_alarm", //事件标识\n   "name": "火警",\n   "valueType": {\n     "type": "object",  //对象(结构体)类型\n     "properties": [    //对象属性(结构与属性定义相同)\n       {\n         "id": "location",\n         "name": "地点",\n         "valueType": {\n           "type": "string"\n         }\n       },\n       {\n         "id": "lng",\n         "name": "经度",\n         "valueType": {\n           "type": "double"\n         },\n         "expands":{"gis":"lng"} //其他自定义拓展定义\n       },\n       {\n         "id": "lat",\n         "name": "纬度",\n         "valueType": {\n           "type": "double"\n         },\n          "expands":{"gis":"lat"} //其他自定义拓展定义\n       }\n     ]\n   },\n   "expands":{"key1":"value1"} //其他自定义拓展定义\n}\n')])]),e._v(" "),n("h3",{attrs:{id:"数据类型"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#数据类型"}},[e._v("#")]),e._v(" 数据类型")]),e._v(" "),n("p",[e._v("所有类型共有属性:")]),e._v(" "),n("ul",[n("li",[e._v("id 唯一标识")]),e._v(" "),n("li",[e._v("name 名称")]),e._v(" "),n("li",[e._v("description 描述")]),e._v(" "),n("li",[e._v("expands 自定义配置")])]),e._v(" "),n("p",[e._v("类型定义")]),e._v(" "),n("ol",[n("li",[n("p",[e._v("int 整型")])]),e._v(" "),n("li",[n("p",[e._v("long 长整型")])]),e._v(" "),n("li",[n("p",[e._v("float 单精度浮点型")])]),e._v(" "),n("li",[n("p",[e._v("double 双精度浮点型")]),e._v(" "),n("p",[e._v("以上均为数字类型,共有属性:")]),e._v(" "),n("ul",[n("li",[e._v("max 最大值")]),e._v(" "),n("li",[e._v("min 最小值")]),e._v(" "),n("li",[e._v("unit 单位")])]),e._v(" "),n("p",[e._v("例:")]),e._v(" "),n("pre",[n("code",[e._v(' {\n "type":"double",\n "max":100,\n "min":0,\n "unit":"percent",\n "expands":{"readonly":true}\n }\n')])])]),e._v(" "),n("li",[n("p",[e._v("boolean 布尔类型")]),e._v(" "),n("p",[e._v("属性")]),e._v(" "),n("ul",[n("li",[e._v("trueText 为true时的文本,默认为"),n("code",[e._v("是")])]),e._v(" "),n("li",[e._v("falseText 为false时的文本,默认为"),n("code",[e._v("否")])]),e._v(" "),n("li",[e._v("trueValue  为true时的值,默认为"),n("code",[e._v("true")])]),e._v(" "),n("li",[e._v("falseValue 为false时的值,默认为"),n("code",[e._v("false")])])]),e._v(" "),n("p",[e._v("例:")]),e._v(" "),n("pre",[n("code",[e._v(' {\n     "type":"boolean",\n     "trueText":"开启",\n     "falseText":"关闭",\n     "trueValue":"1",\n     "falseValue":"0"\n }\n')])])]),e._v(" "),n("li",[n("p",[e._v("string 字符类型")]),e._v(" "),n("p",[e._v("例:")]),e._v(" "),n("pre",[n("code",[e._v(' {\n    "type":"string",\n    "expands":{"maxLen","255"}\n }\n')])])]),e._v(" "),n("li",[n("p",[e._v("enum   枚举类型")]),e._v(" "),n("p",[e._v("属性:")]),e._v(" "),n("ul",[n("li",[e._v("elements (Element)枚举中的元素")])]),e._v(" "),n("p",[e._v("Element:")]),e._v(" "),n("ul",[n("li",[e._v("value 枚举值")]),e._v(" "),n("li",[e._v("text 枚举文本")]),e._v(" "),n("li",[e._v("description 说明")])]),e._v(" "),n("p",[e._v("例:")]),e._v(" "),n("pre",[n("code",[e._v(' {\n     "type":"enum",\n     "elements":[\n         {"value":"1","text":"正常"},\n         {"value":"-1","text":"警告"},\n         {"value":"0","text":"未知"}\n     ]\n }\n')])])]),e._v(" "),n("li",[n("p",[e._v("date   时间类型")]),e._v(" "),n("p",[e._v("属性:")]),e._v(" "),n("ul",[n("li",[e._v("format 格式,如: yyyy-MM-dd")]),e._v(" "),n("li",[e._v("tz 时区,如: Asia/Shanghai")])]),e._v(" "),n("p",[e._v("例:")]),e._v(" "),n("pre",[n("code",[e._v(' {\n     "type":"date",\n     "format":"yyyy-MM-dd",\n     "tz": "Asia/Shanghai"\n }\n')])])]),e._v(" "),n("li",[n("p",[e._v("password 密码类型")]),e._v(" "),n("p",[e._v("与string类型相同")])]),e._v(" "),n("li",[n("p",[e._v("file  文件类型")]),e._v(" "),n("p",[e._v("属性:")]),e._v(" "),n("ul",[n("li",[e._v("bodyType 类型: url,base64,binary")])]),e._v(" "),n("p",[e._v("例:")]),e._v(" "),n("pre",[n("code",[e._v('{\n   "type":"file",\n   "bodyType":"url"\n}\n')])])]),e._v(" "),n("li",[n("p",[e._v("array 数组(集合)类型")]),e._v(" "),n("p",[e._v("属性:")]),e._v(" "),n("ul",[n("li",[e._v("elementType 元素类型")])]),e._v(" "),n("p",[e._v("例:")]),e._v(" "),n("pre",[n("code",[e._v('{\n    "type":"array",\n    "elementType":{ \n        "type":"string"\n    }\n}\n')])])]),e._v(" "),n("li",[n("p",[e._v("object  对象(结构体)类型")]),e._v(" "),n("p",[e._v("属性:\n- properties 属性列表")]),e._v(" "),n("p",[e._v("例:")]),e._v(" "),n("pre",[n("code",[e._v('{\n    "type":"object",\n    "properties":[\n        {\n         "id": "location",\n         "name": "地点",\n         "valueType": {\n           "type": "string"\n         }\n       },\n       {\n         "id": "lng",\n         "name": "经度",\n         "valueType": {\n           "type": "double"\n         },\n         "expands":{"gis":"lng"}\n       },\n       {\n         "id": "lat",\n         "name": "纬度",\n         "valueType": {\n           "type": "double"\n         },\n          "expands":{"gis":"lat"}\n       }\n    ]\n}\n')])])])]),e._v(" "),n("h2",{attrs:{id:"mqtt-s-接入"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#mqtt-s-接入"}},[e._v("#")]),e._v(" MQTT(S)接入")]),e._v(" "),n("p",[e._v("目前支持MQTT3.1.1和3.1版本协议.")]),e._v(" "),n("h3",{attrs:{id:"认证"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#认证"}},[e._v("#")]),e._v(" 认证")]),e._v(" "),n("p",[e._v("CONNECT报文:")]),e._v(" "),n("div",{staticClass:"language- extra-class"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[e._v('clientId: 设备实例ID\nusername: secureId+"|"+timestamp\npassword: md5(secureId+"|"+timestamp+"|"+secureKey)\n')])])]),n("p",[e._v("说明: "),n("code",[e._v("secureId")]),e._v("以及"),n("code",[e._v("secureKey")]),e._v("在创建设备产品和设备实例时进行配置.\n"),n("code",[e._v("timestamp")]),e._v("为当前系统时间戳(毫秒),与系统时间不能相差5分钟.")]),e._v(" "),n("h3",{attrs:{id:"topic"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#topic"}},[e._v("#")]),e._v(" Topic")]),e._v(" "),n("ul",[n("li",[n("p",[e._v("读取设备属性:")]),e._v(" "),n("p",[e._v("topic: "),n("code",[e._v("/{productId}/{deviceId}/properties/read")])]),e._v(" "),n("p",[e._v("方向: "),n("code",[e._v("下行")])]),e._v(" "),n("p",[e._v("消息格式:")]),e._v(" "),n("pre",[n("code",[e._v(' {\n "messageId":"消息ID",\n "deviceId":"设备ID",\n "properties":["sn","model"] //要读取到属性列表\n }\n')])]),e._v(" "),n("p",[e._v("回复Topic: "),n("code",[e._v("/{productId}/{deviceId}/properties/read/reply")])]),e._v(" "),n("p",[e._v("回复消息格式:")]),e._v(" "),n("pre",[n("code",[e._v(' //成功\n {\n   "messageId":"与下行消息中的messageId相同",\n   "properties":{"sn":"test","model":"test"}, //key与设备模型中定义的属性id一致\n   "deviceId":"设备ID",\n   "success":true,\n }\n //失败. 下同\n {\n   "messageId":"与下行消息中的messageId相同",\n   "success":false,\n   "code":"error_code",\n   "message":"失败原因"\n }\n')])])]),e._v(" "),n("li",[n("p",[e._v("修改设备属性:")]),e._v(" "),n("p",[e._v("topic: "),n("code",[e._v("/{productId}/{deviceId}/properties/write")])]),e._v(" "),n("p",[e._v("消息格式:")]),e._v(" "),n("pre",[n("code",[e._v(' {\n  "messageId":"消息ID",\n  "deviceId":"设备ID",\n  "properties":{"color":"red"} //要设置的属性\n }\n')])]),e._v(" "),n("p",[e._v("回复Topic: "),n("code",[e._v("/{productId}/{deviceId}/properties/wirte/reply")])]),e._v(" "),n("p",[e._v("回复消息格式:")]),e._v(" "),n("pre",[n("code",[e._v(' {\n   "messageId":"与下行消息中的messageId相同",\n   "properties":{"color":"red"}, //设置成功后的属性,可不返回\n   "success":true,\n }\n')])])]),e._v(" "),n("li",[n("p",[e._v("调用设备功能")]),e._v(" "),n("p",[e._v("topic: "),n("code",[e._v("/{productId}/{deviceId}/function/invoke")])]),e._v(" "),n("p",[e._v("消息格式:")]),e._v(" "),n("pre",[n("code",[e._v('  {\n   "messageId":"消息ID",\n   "deviceId":"设备ID",\n   "function":"playVoice",//功能ID\n   "inputs":[{"name":"text","value":"播放声音"}] //参数\n  }\n')])]),e._v(" "),n("p",[e._v("回复Topic: "),n("code",[e._v("/{productId}/{deviceId}/function/invoke/reply")])]),e._v(" "),n("p",[e._v("回复消息格式:")]),e._v(" "),n("pre",[n("code",[e._v('  {\n    "messageId":"与下行消息中的messageId相同",\n    "output":"success", //返回执行结果\n    "success":true,\n  }\n')])])]),e._v(" "),n("li",[n("p",[e._v("设备事件上报")]),e._v(" "),n("p",[e._v("topic: "),n("code",[e._v("/{productId}/{deviceId}/event/{eventId}")])]),e._v(" "),n("p",[e._v("消息格式:")]),e._v(" "),n("pre",[n("code",[e._v(' {\n "messageId":"随机消息ID",\n "data":100 //上报数据\n }\n')])]),e._v(" "),n("p",[e._v("拓展:")]),e._v(" "),n("p",[e._v("定时上报属性:")]),e._v(" "),n("pre",[n("code",[e._v(' {\n "messageId":"随机消息ID",\n "data":{"color":"red"},//属性列表\n "headers":{"report-properties":true} //标记为上报属性事件\n } \n')])])])]),e._v(" "),n("h2",{attrs:{id:"coap接入"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#coap接入"}},[e._v("#")]),e._v(" CoAP接入")]),e._v(" "),n("p",[e._v("使用CoAP协议接入仅需要对数据进行加密即可.加密算法: AES/ECB/PKCS5Padding.")]),e._v(" "),n("p",[e._v("使用自定义Option: "),n("code",[e._v("2100:设备ID")]),e._v(" 来标识设备.")]),e._v(" "),n("p",[e._v("将请求体进行加密,密钥为在创建设备产品和设备实例时进行配置的("),n("code",[e._v("secureKey")]),e._v(").")]),e._v(" "),n("p",[e._v("请求地址("),n("code",[e._v("URI")]),e._v(")与MQTT "),n("code",[e._v("Topic")]),e._v("相同.消息体("),n("code",[e._v("payload")]),e._v(")与MQTT相同.")]),e._v(" "),n("h2",{attrs:{id:"dtls接入"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#dtls接入"}},[e._v("#")]),e._v(" DTLS接入")]),e._v(" "),n("p",[e._v("使用CoAP DTLS 协议接入时需要先进行认证:")]),e._v(" "),n("p",[e._v("发送认证请求:")]),e._v(" "),n("div",{staticClass:"language-text extra-class"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[e._v('POST /auth\nAccept: application/json\nContent-Format: application/json\n2100: 设备ID\n2110: 签名 md5(payload+secureKey)\npayload: {"timestamp":"时间戳"}\n')])])]),n("p",[e._v("响应结果:")]),e._v(" "),n("div",{staticClass:"language-text extra-class"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[e._v('2.05 (Content)\npayload: {"token":"令牌"}\n')])])]),n("p",[e._v("之后的请求中需要将返回的令牌携带到自定义Option:2111")]),e._v(" "),n("p",[e._v("例如:")]),e._v(" "),n("div",{staticClass:"language-text extra-class"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[e._v("POST /test/device1/event/fire_alarm\n2100: 设备ID\n2111: 令牌\n...其他Option\npayload: json数据\n")])])])])}),[],!1,null,null,null);v.default=t.exports}}]);